# ğŸ› Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø§Ù…Ø¹ Ø¨Ø§Ú¯â€ŒÙ‡Ø§ Ùˆ Ú¯Ù¾â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ù…Ù‡Ø±Ø¨Ø±Ø§Ù†

> **ØªØ§Ø±ÛŒØ® Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ:** Û²Û² Ø¨Ù‡Ù…Ù† Û±Û´Û°Û³
> **Ù†Ø³Ø®Ù‡:** 1.0.0
> **ÙˆØ¶Ø¹ÛŒØª:** Critical Issues Found

---

## ğŸ“‹ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

1. [Ø®Ù„Ø§ØµÙ‡ Ø§Ø¬Ø±Ø§ÛŒÛŒ](#Ø®Ù„Ø§ØµÙ‡-Ø§Ø¬Ø±Ø§ÛŒÛŒ)
2. [Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Critical](#Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ-critical)
3. [Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ High Priority](#Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ-high-priority)
4. [Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Medium Priority](#Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ-medium-priority)
5. [Ú¯Ù¾â€ŒÙ‡Ø§ÛŒ Infrastructure](#Ú¯Ù¾â€ŒÙ‡Ø§ÛŒ-infrastructure)
6. [Ú¯Ù¾â€ŒÙ‡Ø§ÛŒ External Services](#Ú¯Ù¾â€ŒÙ‡Ø§ÛŒ-external-services)
7. [Ù…Ø´Ú©Ù„Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ](#Ù…Ø´Ú©Ù„Ø§Øª-Ø§Ù…Ù†ÛŒØªÛŒ)
8. [Ù…Ø´Ú©Ù„Ø§Øª Performance](#Ù…Ø´Ú©Ù„Ø§Øª-performance)
9. [Ú¯Ù¾â€ŒÙ‡Ø§ÛŒ Testing](#Ú¯Ù¾â€ŒÙ‡Ø§ÛŒ-testing)
10. [Ù…Ø´Ú©Ù„Ø§Øª Documentation](#Ù…Ø´Ú©Ù„Ø§Øª-documentation)
11. [Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Roadmap](#Ø§ÙˆÙ„ÙˆÛŒØªØ¨Ù†Ø¯ÛŒ-Ùˆ-roadmap)

---

## ğŸ¯ Ø®Ù„Ø§ØµÙ‡ Ø§Ø¬Ø±Ø§ÛŒÛŒ

Ø¯Ø± Ø·ÙˆÙ„ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¬Ø§Ù…Ø¹ Ù¾Ø±ÙˆÚ˜Ù‡ØŒ **Û´Ûµ+ Ù…Ø´Ú©Ù„** Ø¯Ø± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯:

### Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ

| Ø¯Ø³ØªÙ‡ | ØªØ¹Ø¯Ø§Ø¯ | ÙˆØ¶Ø¹ÛŒØª |
|------|-------|-------|
| **ğŸ”´ Critical Bugs** | 8 | Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø±ÙØ¹ ÙÙˆØ±ÛŒ |
| **ğŸŸ  High Priority** | 12 | Ø±ÙØ¹ Ø¯Ø± Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯Øª |
| **ğŸŸ¡ Medium Priority** | 15 | Ø±ÙØ¹ Ø¯Ø± Ù…ÛŒØ§Ù†â€ŒÙ…Ø¯Øª |
| **âšª Low Priority** | 10 | Ø±ÙØ¹ Ø¯Ø± Ø¨Ù„Ù†Ø¯â€ŒÙ…Ø¯Øª |
| **Ø¬Ù…Ø¹ Ú©Ù„** | **45+** | |

### ØªÙˆØ²ÛŒØ¹ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹

```
API/Backend Issues:          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 15 Ù…ÙˆØ±Ø¯ (33%)
Frontend Issues:             â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  6 Ù…ÙˆØ±Ø¯ (13%)
Infrastructure Gaps:         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 10 Ù…ÙˆØ±Ø¯ (22%)
External Services Missing:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  7 Ù…ÙˆØ±Ø¯ (16%)
Security Issues:             â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  5 Ù…ÙˆØ±Ø¯ (11%)
Performance Issues:          â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2 Ù…ÙˆØ±Ø¯ (4%)
```

---

## ğŸ”´ Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Critical

### 1. âŒ API Endpoint Mismatch - Discovery Module

**Ø´Ø¯Øª:** ğŸ”´ Critical
**Ù…Ú©Ø§Ù†:** Frontend â†” Backend
**ØªØ§Ø«ÛŒØ±:** Feature Ú©Ø§Ù…Ù„Ø§Ù‹ Ø®Ø±Ø§Ø¨ Ø§Ø³Øª

#### Ù…Ø´Ú©Ù„:
Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ API Ø¯Ø± frontend Ø¨Ø§ backend Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ù†Ø¯.

#### Ø¬Ø²Ø¦ÛŒØ§Øª:

**Frontend Calls:**
```typescript
// packages/web/src/services/discovery.service.ts
async getRecommendedNeeds() {
  const response = await api.get(`/discovery/recommendations/needs`);
  //                                    ^^^^^^^^^^^^^^^^^^^^
}

async getTrendingNeeds() {
  const response = await api.get(`/discovery/trending/needs`);
  //                                    ^^^^^^^^^^^^^^^
}
```

**Backend Routes:**
```typescript
// packages/api/src/modules/discovery/discovery.routes.ts
router.get('/recommendations', ...);  // âŒ Ù…Ø³ÛŒØ± Ù…ØªÙØ§ÙˆØª
router.get('/trending', ...);          // âŒ Ù…Ø³ÛŒØ± Ù…ØªÙØ§ÙˆØª
```

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
// Ú¯Ø²ÛŒÙ†Ù‡ 1: ØªØºÛŒÛŒØ± Backend routes
router.get('/recommendations/needs', ...);
router.get('/trending/needs', ...);

// Ú¯Ø²ÛŒÙ†Ù‡ 2: ØªØºÛŒÛŒØ± Frontend service
api.get(`/discovery/recommendations`);
api.get(`/discovery/trending`);
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- `packages/web/src/services/discovery.service.ts`
- `packages/api/src/modules/discovery/discovery.routes.ts`

---

### 2. âŒ Notification API HTTP Method Mismatch

**Ø´Ø¯Øª:** ğŸ”´ Critical
**Ù…Ú©Ø§Ù†:** Frontend â†” Backend
**ØªØ§Ø«ÛŒØ±:** Mark as read Ø¨Ø±Ø§ÛŒ notifications Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯

#### Ù…Ø´Ú©Ù„:
Frontend Ø§Ø² `PATCH` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Backend `POST` Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø±Ø¯.

#### Ø¬Ø²Ø¦ÛŒØ§Øª:

**Frontend:**
```typescript
// packages/web/src/services/notification.service.ts
async markAsRead(id: string) {
  const response = await api.patch(`/notifications/${id}/read`);
  //                            ^^^^^ PATCH
}
```

**Backend:**
```typescript
// packages/api/src/modules/notification/notification.routes.ts
router.post('/:id/read', ...);  // âŒ Ø§Ù†ØªØ¸Ø§Ø± POST Ø¯Ø§Ø±Ø¯
```

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
// Ú¯Ø²ÛŒÙ†Ù‡ 1: ØªØºÛŒÛŒØ± Backend (ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ - RESTful)
router.patch('/:id/read', ...);

// Ú¯Ø²ÛŒÙ†Ù‡ 2: ØªØºÛŒÛŒØ± Frontend
api.post(`/notifications/${id}/read`);
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- `packages/web/src/services/notification.service.ts:28`
- `packages/api/src/modules/notification/notification.routes.ts`

---

### 3. âŒ Task Module Path Structure Incorrect

**Ø´Ø¯Øª:** ğŸ”´ Critical
**Ù…Ú©Ø§Ù†:** Frontend â†” Backend
**ØªØ§Ø«ÛŒØ±:** Task management Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯

#### Ù…Ø´Ú©Ù„:
Ø³Ø§Ø®ØªØ§Ø± path Ø¯Ø± task module Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª.

#### Ø¬Ø²Ø¦ÛŒØ§Øª:

**Frontend:**
```typescript
// packages/web/src/services/task.service.ts
async getTasks(needId: string) {
  const response = await api.get(`/needs/${needId}/tasks`);
  //                                ^^^^^^^^^^^^^^^^^^^^^^
}
```

**Backend:**
```typescript
// Ù…Ù…Ú©Ù† Ø§Ø³Øª route Ø¨Ù‡ ØµÙˆØ±Øª /tasks/:needId Ø¨Ø§Ø´Ø¯
// ÛŒØ§ structure Ù…ØªÙØ§ÙˆØªÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
```

#### Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ:
- Ú†Ú© Ú©Ø±Ø¯Ù† actual backend routes
- ØªØ·Ø¨ÛŒÙ‚ Ø¯Ø§Ø¯Ù† Ø¨Ø§ frontend calls

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- `packages/web/src/services/task.service.ts`
- `packages/api/src/modules/task/` (Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ)

---

### 4. âŒ Missing Database Connection Error Handling

**Ø´Ø¯Øª:** ğŸ”´ Critical
**Ù…Ú©Ø§Ù†:** Backend - Database Config
**ØªØ§Ø«ÛŒØ±:** App crash Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø§Ú¯Ø± MongoDB Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†Ø¨Ø§Ø´Ø¯

#### Ù…Ø´Ú©Ù„:
Ø§Ú¯Ø± MongoDB connection fail Ø´ÙˆØ¯ØŒ Ù‡ÛŒÚ† graceful error handling ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.

#### Ú©Ø¯ ÙØ¹Ù„ÛŒ:
```typescript
// packages/api/src/core/config/database.config.ts
mongoose.connect(DATABASE_URL);
// âŒ Ø§Ú¯Ø± fail Ø´ÙˆØ¯ Ú†Ù‡ Ø§ØªÙØ§Ù‚ÛŒ Ù…ÛŒâ€ŒØ§ÙØªØ¯ØŸ
```

#### Ø±Ø§Ù‡ Ø­Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:
```typescript
const connectDB = async () => {
  try {
    await mongoose.connect(DATABASE_URL, {
      serverSelectionTimeoutMS: 5000,
      socketTimeoutMS: 45000,
    });
    console.log('âœ… MongoDB connected successfully');
  } catch (error) {
    console.error('âŒ MongoDB connection failed:', error.message);

    // Retry logic
    console.log('â³ Retrying in 5 seconds...');
    setTimeout(connectDB, 5000);
  }
};

mongoose.connection.on('disconnected', () => {
  console.warn('âš ï¸ MongoDB disconnected. Attempting to reconnect...');
});

mongoose.connection.on('error', (err) => {
  console.error('âŒ MongoDB error:', err);
});
```

#### ÙØ§ÛŒÙ„ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- `packages/api/src/core/config/database.config.ts`

---

### 5. âŒ Missing Environment Variables Validation

**Ø´Ø¯Øª:** ğŸ”´ Critical
**Ù…Ú©Ø§Ù†:** Backend - Config
**ØªØ§Ø«ÛŒØ±:** App Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± undefined Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯

#### Ù…Ø´Ú©Ù„:
Ù‡ÛŒÚ† validation Ø¨Ø±Ø§ÛŒ environment variables ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.

#### Ù…Ø«Ø§Ù„:
```typescript
// Ø§Ú¯Ø± DATABASE_URL undefined Ø¨Ø§Ø´Ø¯
const DATABASE_URL = process.env.DATABASE_URL;
// âŒ Ù‡ÛŒÚ† Ú†Ú©ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯

mongoose.connect(DATABASE_URL); // crash!
```

#### Ø±Ø§Ù‡ Ø­Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:
```typescript
// packages/api/src/core/config/env.validation.ts
import { z } from 'zod';

const envSchema = z.object({
  NODE_ENV: z.enum(['development', 'production', 'test']),
  PORT: z.string().transform(Number),
  DATABASE_URL: z.string().url(),
  JWT_SECRET: z.string().min(32),
  JWT_EXPIRES_IN: z.string(),
  FRONTEND_URL: z.string().url(),
});

export const validateEnv = () => {
  try {
    const env = envSchema.parse(process.env);
    return env;
  } catch (error) {
    console.error('âŒ Invalid environment variables:');
    console.error(error.errors);
    process.exit(1);
  }
};

// Ø¯Ø± server.ts
validateEnv();
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- `packages/api/src/server.ts`
- Create: `packages/api/src/core/config/env.validation.ts`

---

### 6. âŒ CORS Origin Set to Wildcard (*)

**Ø´Ø¯Øª:** ğŸ”´ Critical (Security)
**Ù…Ú©Ø§Ù†:** Backend - App Config
**ØªØ§Ø«ÛŒØ±:** Ù‡Ø± origin Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ API Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯

#### Ú©Ø¯ ÙØ¹Ù„ÛŒ:
```typescript
// packages/api/src/app.ts
app.use(cors({
  origin: '*',  // âŒ Ø®Ø·Ø±Ù†Ø§Ú©!
  credentials: true
}));
```

#### Ù…Ø´Ú©Ù„:
- Ù‡Ø± Ø³Ø§ÛŒØªÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ API Ø´Ù…Ø§ request Ø¨Ø²Ù†Ø¯
- Ø§Ú¯Ø± credentials: true Ù‡Ù… Ø¨Ø§Ø´Ø¯ØŒ Ø®ÛŒÙ„ÛŒ Ø®Ø·Ø±Ù†Ø§Ú© Ø§Ø³Øª
- CSRF attacks Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³Øª

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
const allowedOrigins = [
  process.env.FRONTEND_URL || 'http://localhost:3000',
  'https://mehrebaran.org',
  'https://www.mehrebaran.org',
];

app.use(cors({
  origin: (origin, callback) => {
    // Allow requests with no origin (mobile apps, Postman, etc.)
    if (!origin) return callback(null, true);

    if (allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'PATCH', 'DELETE'],
  allowedHeaders: ['Content-Type', 'Authorization'],
}));
```

#### ÙØ§ÛŒÙ„ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- `packages/api/src/app.ts`

---

### 7. âŒ No Rate Limiting on API Endpoints

**Ø´Ø¯Øª:** ğŸ”´ Critical (Security & Performance)
**Ù…Ú©Ø§Ù†:** Backend - Middleware
**ØªØ§Ø«ÛŒØ±:** API vulnerable Ø¨Ù‡ brute force Ùˆ DDoS attacks

#### Ù…Ø´Ú©Ù„:
Ù‡ÛŒÚ† rate limiting ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯:
- Ù‡Ø²Ø§Ø±Ø§Ù† request Ø¯Ø± Ø«Ø§Ù†ÛŒÙ‡ Ø¨Ø²Ù†Ø¯
- OTP Ø±Ø§ brute force Ú©Ù†Ø¯
- Login Ø±Ø§ brute force Ú©Ù†Ø¯
- Ø³Ø±ÙˆØ± Ø±Ø§ overload Ú©Ù†Ø¯

#### Ø±Ø§Ù‡ Ø­Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:
```bash
pnpm add express-rate-limit
```

```typescript
// packages/api/src/core/middleware/rateLimiter.middleware.ts
import rateLimit from 'express-rate-limit';

// General API rate limiter
export const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // 100 requests per 15 minutes
  message: 'ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ú¯Ø°Ø´ØªÙ‡ Ø§Ø³Øª. Ù„Ø·ÙØ§ Ø¨Ø¹Ø¯Ø§ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.',
  standardHeaders: true,
  legacyHeaders: false,
});

// Strict limiter for auth endpoints
export const authLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 5, // 5 attempts per 15 minutes
  message: 'ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚ Ø²ÛŒØ§Ø¯ Ø§Ø³Øª. Ù„Ø·ÙØ§ 15 Ø¯Ù‚ÛŒÙ‚Ù‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯.',
  skipSuccessfulRequests: true, // Don't count successful requests
});

// OTP rate limiter
export const otpLimiter = rateLimit({
  windowMs: 60 * 60 * 1000, // 1 hour
  max: 3, // 3 OTP requests per hour per IP
  message: 'Ø´Ù…Ø§ Ø§Ù…Ø±ÙˆØ² Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² OTP Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.',
});

// Ø¯Ø± app.ts
app.use('/api/v1', apiLimiter);
app.use('/api/v1/auth/login', authLimiter);
app.use('/api/v1/auth/send-otp', otpLimiter);
app.use('/api/v1/auth/verify-otp', authLimiter);
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/api/src/core/middleware/rateLimiter.middleware.ts`
- Update: `packages/api/src/app.ts`

---

### 8. âŒ No Input Sanitization for User-Generated Content

**Ø´Ø¯Øª:** ğŸ”´ Critical (Security - XSS)
**Ù…Ú©Ø§Ù†:** Backend - Controllers
**ØªØ§Ø«ÛŒØ±:** XSS attacks Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³Øª

#### Ù…Ø´Ú©Ù„:
Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ HTML/JavaScript Ø¯Ø± Ù…Ø­ØªÙˆØ§ Ø¨Ù†ÙˆÛŒØ³Ù†Ø¯ Ú©Ù‡ Ø¯Ø± browser Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

#### Ù…Ø«Ø§Ù„ Ø­Ù…Ù„Ù‡:
```javascript
// User creates a need with malicious content
{
  title: "Ù†ÛŒØ§Ø² Ø®ÙˆØ¨",
  description: "<script>alert('XSS');</script> <img src=x onerror='alert(1)'>",
  updates: [
    {
      content: "<iframe src='http://malicious.com'></iframe>"
    }
  ]
}
```

#### Ø±Ø§Ù‡ Ø­Ù„:
```bash
pnpm add dompurify jsdom
```

```typescript
// packages/api/src/core/utils/sanitize.ts
import createDOMPurify from 'dompurify';
import { JSDOM } from 'jsdom';

const window = new JSDOM('').window;
const DOMPurify = createDOMPurify(window as any);

export const sanitizeHtml = (dirty: string): string => {
  return DOMPurify.sanitize(dirty, {
    ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'a', 'p', 'br', 'ul', 'ol', 'li'],
    ALLOWED_ATTR: ['href', 'target'],
  });
};

export const sanitizeText = (text: string): string => {
  // Remove all HTML tags
  return DOMPurify.sanitize(text, { ALLOWED_TAGS: [] });
};

// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± controller
import { sanitizeHtml, sanitizeText } from '@/core/utils/sanitize';

export const createNeed = async (req: Request, res: Response) => {
  const { title, description, updates } = req.body;

  const sanitizedData = {
    title: sanitizeText(title),
    description: sanitizeHtml(description),
    updates: updates?.map(u => ({
      ...u,
      content: sanitizeHtml(u.content),
    })),
  };

  // Create need with sanitized data
};
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/api/src/core/utils/sanitize.ts`
- Update: Ù‡Ù…Ù‡ controllers Ú©Ù‡ user input Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯

---

## ğŸŸ  Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ High Priority

### 9. âš ï¸ Missing .env.example Files

**Ø´Ø¯Øª:** ğŸŸ  High
**Ù…Ú©Ø§Ù†:** Root, packages/api, packages/web
**ØªØ§Ø«ÛŒØ±:** ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ù†Ù…ÛŒâ€ŒØ¯Ø§Ù†Ù†Ø¯ Ú†Ù‡ environment variables Ù†ÛŒØ§Ø² Ø§Ø³Øª

#### Ù…Ø´Ú©Ù„:
Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ `.env.example` ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.

#### Ø±Ø§Ù‡ Ø­Ù„:
Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ `.env.example`:

```bash
# packages/api/.env.example
NODE_ENV=development
PORT=5000

# Database
DATABASE_URL=mongodb://localhost:27017/mehrebaran

# JWT
JWT_SECRET=your-super-secret-jwt-key-min-32-characters-long
JWT_EXPIRES_IN=7d

# Frontend
FRONTEND_URL=http://localhost:3000

# File Upload
MAX_FILE_SIZE=10485760
UPLOAD_DIR=./uploads

# External Services (Optional)
# EMAIL_SERVICE=sendgrid
# EMAIL_API_KEY=
# SMS_SERVICE=twilio
# SMS_ACCOUNT_SID=
# SMS_AUTH_TOKEN=
# FIREBASE_SERVER_KEY=

# Redis (Optional)
# REDIS_URL=redis://localhost:6379

# AWS S3 (Optional)
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_REGION=
# AWS_S3_BUCKET=
```

```bash
# packages/web/.env.example
NEXT_PUBLIC_API_URL=http://localhost:5000/api/v1
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/api/.env.example`
- Create: `packages/web/.env.example`

---

### 10. âš ï¸ OTP Verification Has No Attempt Limit

**Ø´Ø¯Øª:** ğŸŸ  High (Security)
**Ù…Ú©Ø§Ù†:** Backend - Auth Module
**ØªØ§Ø«ÛŒØ±:** OTP Ù‚Ø§Ø¨Ù„ brute force Ø§Ø³Øª

#### Ù…Ø´Ú©Ù„:
Ù‡ÛŒÚ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØªÛŒ Ø¨Ø±Ø§ÛŒ ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ÛŒ verify OTP ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.

#### Ú©Ø¯ ÙØ¹Ù„ÛŒ:
```typescript
// User can try unlimited OTP codes
export const verifyOtp = async (req, res) => {
  const { mobile, code } = req.body;

  const otp = await OTP.findOne({ mobile, code });
  // âŒ Ù‡ÛŒÚ† Ú†Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ Ù†ÛŒØ³Øª
};
```

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
// Update OTP model
const otpSchema = new Schema({
  mobile: String,
  code: String,
  attempts: { type: Number, default: 0 },  // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†
  maxAttempts: { type: Number, default: 5 },
  isBlocked: { type: Boolean, default: false },
  expiresAt: Date,
});

// Ø¯Ø± controller
export const verifyOtp = async (req, res) => {
  const { mobile, code } = req.body;

  const otp = await OTP.findOne({ mobile, isBlocked: false });

  if (!otp) {
    return res.status(400).json({ message: 'Ú©Ø¯ OTP Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª' });
  }

  if (otp.attempts >= otp.maxAttempts) {
    otp.isBlocked = true;
    await otp.save();
    return res.status(429).json({
      message: 'ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø§Ø³Øª. Ù„Ø·ÙØ§ OTP Ø¬Ø¯ÛŒØ¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù†ÛŒØ¯.'
    });
  }

  if (otp.code !== code) {
    otp.attempts += 1;
    await otp.save();

    const remainingAttempts = otp.maxAttempts - otp.attempts;
    return res.status(400).json({
      message: `Ú©Ø¯ OTP Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª. ${remainingAttempts} ØªÙ„Ø§Ø´ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡.`
    });
  }

  // Success - verify user
  // ...
};
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- `packages/api/src/models/OTP.ts`
- `packages/api/src/modules/auth/auth.controller.ts`

---

### 11. âš ï¸ Password Reset Flow Missing

**Ø´Ø¯Øª:** ğŸŸ  High
**Ù…Ú©Ø§Ù†:** Backend - Auth Module
**ØªØ§Ø«ÛŒØ±:** Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ password Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†Ù†Ø¯

#### Ù…Ø´Ú©Ù„:
Ù‡ÛŒÚ† endpoint Ø¨Ø±Ø§ÛŒ reset password ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.

#### Feature Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:
1. `POST /auth/forgot-password` - Ø¯Ø±Ø®ÙˆØ§Ø³Øª reset token
2. `POST /auth/reset-password` - ØªÙ†Ø¸ÛŒÙ… password Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ token

#### Ø±Ø§Ù‡ Ø­Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:
```typescript
// Model: PasswordReset
const passwordResetSchema = new Schema({
  user: { type: Schema.Types.ObjectId, ref: 'User', required: true },
  token: { type: String, required: true, unique: true },
  expiresAt: { type: Date, required: true },
  used: { type: Boolean, default: false },
});

passwordResetSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 });

// Routes
router.post('/forgot-password', forgotPassword);
router.post('/reset-password', resetPassword);

// Controller
export const forgotPassword = async (req, res) => {
  const { mobile } = req.body;

  const user = await User.findOne({ mobile });
  if (!user) {
    // Don't reveal if user exists
    return res.json({ message: 'Ø§Ú¯Ø± Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯ØŒ Ù„ÛŒÙ†Ú© Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯' });
  }

  // Generate reset token
  const token = crypto.randomBytes(32).toString('hex');
  const expiresAt = new Date(Date.now() + 3600000); // 1 hour

  await PasswordReset.create({ user: user._id, token, expiresAt });

  // Send SMS with reset link
  // await smsService.send(mobile, `Ù„ÛŒÙ†Ú© Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ: ${FRONTEND_URL}/reset-password?token=${token}`);

  res.json({ message: 'Ù„ÛŒÙ†Ú© Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯' });
};

export const resetPassword = async (req, res) => {
  const { token, newPassword } = req.body;

  const resetRequest = await PasswordReset.findOne({
    token,
    used: false,
    expiresAt: { $gt: new Date() }
  });

  if (!resetRequest) {
    return res.status(400).json({ message: 'Ù„ÛŒÙ†Ú© Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª' });
  }

  const user = await User.findById(resetRequest.user);
  user.password = newPassword; // Will be hashed by pre-save hook
  await user.save();

  resetRequest.used = true;
  await resetRequest.save();

  res.json({ message: 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯' });
};
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/api/src/models/PasswordReset.ts`
- Update: `packages/api/src/modules/auth/auth.routes.ts`
- Update: `packages/api/src/modules/auth/auth.controller.ts`

---

### 12. âš ï¸ File Upload Has No Virus Scanning

**Ø´Ø¯Øª:** ğŸŸ  High (Security)
**Ù…Ú©Ø§Ù†:** Backend - Upload Middleware
**ØªØ§Ø«ÛŒØ±:** ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø®Ø±Ø¨ Ù‚Ø§Ø¨Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ù‡Ø³ØªÙ†Ø¯

#### Ù…Ø´Ú©Ù„:
ÙÙ‚Ø· extension Ùˆ size Ú†Ú© Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ù…Ø­ØªÙˆØ§ÛŒ ÙØ§ÛŒÙ„ Ú†Ú© Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.

#### Ø±Ø§Ù‡ Ø­Ù„:
```bash
pnpm add clamscan
```

```typescript
// packages/api/src/core/middleware/virusScan.middleware.ts
import NodeClam from 'clamscan';

const ClamScan = new NodeClam().init({
  clamdscan: {
    host: 'localhost',
    port: 3310,
  },
});

export const scanFile = async (req, res, next) => {
  if (!req.file) return next();

  try {
    const { isInfected, viruses } = await ClamScan.isInfected(req.file.path);

    if (isInfected) {
      // Delete infected file
      fs.unlinkSync(req.file.path);

      return res.status(400).json({
        message: 'ÙØ§ÛŒÙ„ Ø¢Ù„ÙˆØ¯Ù‡ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯',
        viruses
      });
    }

    next();
  } catch (error) {
    // If ClamAV is not available, log warning but allow upload
    console.warn('âš ï¸ Virus scanning not available:', error.message);
    next();
  }
};

// Ø§Ø³ØªÙØ§Ø¯Ù‡
router.post('/upload', upload.single('file'), scanFile, uploadController);
```

#### Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒ:
- Ù†ØµØ¨ ClamAV: `apt-get install clamav clamav-daemon`

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/api/src/core/middleware/virusScan.middleware.ts`

---

### 13. âš ï¸ No Pagination Validation

**Ø´Ø¯Øª:** ğŸŸ  High (Performance)
**Ù…Ú©Ø§Ù†:** Backend - Controllers
**ØªØ§Ø«ÛŒØ±:** Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ `limit=1000000` Ø¨ÙØ±Ø³ØªØ¯ Ùˆ Ø³Ø±ÙˆØ± Ø±Ø§ Ú©Ù†Ø¯ Ú©Ù†Ø¯

#### Ù…Ø´Ú©Ù„:
```typescript
// User can request unlimited items
GET /needs?limit=999999999&page=1
```

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
// packages/api/src/core/middleware/pagination.middleware.ts
export const validatePagination = (req, res, next) => {
  const page = Math.max(1, parseInt(req.query.page) || 1);
  const limit = Math.min(100, Math.max(1, parseInt(req.query.limit) || 20));
  //            ^^^^^^^^^ max 100 items per page

  req.pagination = { page, limit, skip: (page - 1) * limit };
  next();
};

// Ø¯Ø± routes
router.get('/needs', validatePagination, getNeeds);

// Ø¯Ø± controller
export const getNeeds = async (req, res) => {
  const { skip, limit } = req.pagination;

  const needs = await Need.find()
    .skip(skip)
    .limit(limit);

  const total = await Need.countDocuments();

  res.json({
    data: needs,
    pagination: {
      page: req.pagination.page,
      limit,
      total,
      pages: Math.ceil(total / limit),
    },
  });
};
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/api/src/core/middleware/pagination.middleware.ts`
- Update: Ù‡Ù…Ù‡ controllers Ø¨Ø§ pagination

---

### 14. âš ï¸ Socket.IO Partially Implemented

**Ø´Ø¯Øª:** ğŸŸ  High
**Ù…Ú©Ø§Ù†:** Backend - Socket.IO
**ØªØ§Ø«ÛŒØ±:** Real-time features Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯

#### Ù…Ø´Ú©Ù„:
Socket.IO setup Ø´Ø¯Ù‡ Ø§Ù…Ø§ event handlers Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯.

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù†ÛŒÙ…Ù‡â€ŒÚ©Ø§Ø±Ù‡:
```typescript
// packages/api/src/app.ts
import { Server } from 'socket.io';

// Socket.IO setup exists but incomplete
const io = new Server(server);

io.on('connection', (socket) => {
  console.log('User connected');
  // âŒ Ù‡ÛŒÚ† event handler Ø¯ÛŒÚ¯Ø±ÛŒ Ù†ÛŒØ³Øª
});
```

#### Features Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²:
- Real-time notifications
- Live chat/messaging
- Live updates on needs
- Online user presence
- Typing indicators

#### Ø±Ø§Ù‡ Ø­Ù„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:
```typescript
// packages/api/src/core/socket/socket.handler.ts
export const setupSocketHandlers = (io: Server) => {
  io.use(socketAuthMiddleware); // Verify JWT

  io.on('connection', (socket) => {
    const userId = socket.data.userId;
    console.log(`âœ… User ${userId} connected`);

    // Join user's personal room
    socket.join(`user:${userId}`);

    // Handle events
    socket.on('need:subscribe', (needId) => {
      socket.join(`need:${needId}`);
    });

    socket.on('need:unsubscribe', (needId) => {
      socket.leave(`need:${needId}`);
    });

    socket.on('message:send', async (data) => {
      // Handle direct message
      const message = await DirectMessage.create(data);
      io.to(`user:${data.recipient}`).emit('message:new', message);
    });

    socket.on('typing:start', (data) => {
      socket.to(`conversation:${data.conversationId}`).emit('typing', {
        userId,
        isTyping: true,
      });
    });

    socket.on('disconnect', () => {
      console.log(`âŒ User ${userId} disconnected`);
    });
  });
};
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/api/src/core/socket/socket.handler.ts`
- Create: `packages/api/src/core/socket/socket.middleware.ts`
- Update: `packages/api/src/app.ts`

---

### 15. âš ï¸ No Error Logging System

**Ø´Ø¯Øª:** ğŸŸ  High
**Ù…Ú©Ø§Ù†:** Backend - Error Handler
**ØªØ§Ø«ÛŒØ±:** Ù…Ø´Ú©Ù„Ø§Øª production Ù‚Ø§Ø¨Ù„ debug Ù†ÛŒØ³ØªÙ†Ø¯

#### Ù…Ø´Ú©Ù„:
ÙÙ‚Ø· `console.error` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.

#### Ø±Ø§Ù‡ Ø­Ù„:
```bash
pnpm add winston winston-daily-rotate-file
```

```typescript
// packages/api/src/core/utils/logger.ts
import winston from 'winston';
import DailyRotateFile from 'winston-daily-rotate-file';

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    // Console
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      ),
    }),

    // Error logs
    new DailyRotateFile({
      filename: 'logs/error-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      level: 'error',
      maxSize: '20m',
      maxFiles: '14d',
    }),

    // All logs
    new DailyRotateFile({
      filename: 'logs/combined-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      maxSize: '20m',
      maxFiles: '14d',
    }),
  ],
});

export default logger;

// Ø§Ø³ØªÙØ§Ø¯Ù‡
import logger from '@/core/utils/logger';

logger.error('Error message', { error, userId, requestId });
logger.warn('Warning message');
logger.info('Info message');
logger.debug('Debug message');
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/api/src/core/utils/logger.ts`
- Update: `packages/api/src/core/middleware/error.middleware.ts`

---

### 16. âš ï¸ Frontend: No Error Boundary

**Ø´Ø¯Øª:** ğŸŸ  High
**Ù…Ú©Ø§Ù†:** Frontend - React
**ØªØ§Ø«ÛŒØ±:** ÛŒÚ© error Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ù„ app Ø±Ø§ crash Ú©Ù†Ø¯

#### Ù…Ø´Ú©Ù„:
Ù‡ÛŒÚ† Error Boundary ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
// packages/web/src/components/ErrorBoundary.tsx
'use client';

import React from 'react';

interface Props {
  children: React.ReactNode;
  fallback?: React.ReactNode;
}

interface State {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends React.Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);

    // Send to error tracking service
    // trackError(error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div className="min-h-screen flex items-center justify-center bg-gray-50">
          <div className="text-center p-8">
            <h1 className="text-2xl font-bold text-red-600 mb-4">
              Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª
            </h1>
            <p className="text-gray-600 mb-6">
              Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯
            </p>
            <button
              onClick={() => window.location.reload()}
              className="bg-blue-600 text-white px-6 py-2 rounded-lg"
            >
              Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± layout.tsx
import { ErrorBoundary } from '@/components/ErrorBoundary';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <ErrorBoundary>
          <AuthProvider>
            {children}
          </AuthProvider>
        </ErrorBoundary>
      </body>
    </html>
  );
}
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/web/src/components/ErrorBoundary.tsx`
- Update: `packages/web/src/app/layout.tsx`

---

### 17. âš ï¸ Frontend: API Errors Not Properly Handled

**Ø´Ø¯Øª:** ğŸŸ  High
**Ù…Ú©Ø§Ù†:** Frontend - Services
**ØªØ§Ø«ÛŒØ±:** Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯

#### Ù…Ø´Ú©Ù„:
```typescript
// ÙÙ‚Ø· console.error Ùˆ throw Error
catch (error: any) {
  console.error("Error:", error);
  throw new Error(error.response?.data?.message || "Ø®Ø·Ø§");
  // âŒ Ú©Ø§Ø±Ø¨Ø± Ø§ÛŒÙ† error Ø±Ø§ Ù†Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ø¯
}
```

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
// packages/web/src/lib/toast.ts (Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯)
import { toast } from 'react-hot-toast'; // ÛŒØ§ Ù‡Ø± toast library

export const showError = (message: string) => {
  toast.error(message, { duration: 4000 });
};

export const showSuccess = (message: string) => {
  toast.success(message, { duration: 3000 });
};

// Ø¯Ø± services
import { showError } from '@/lib/toast';

catch (error: any) {
  const message = error.response?.data?.message || "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª";
  console.error("Error:", error);
  showError(message); // âœ… Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
  throw error;
}

// Ø¯Ø± components
try {
  await needService.createNeed(data);
  showSuccess('Ù†ÛŒØ§Ø² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯');
  router.push('/network/needs');
} catch (error) {
  // Error already shown by service
  // Can add additional handling here
}
```

#### Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒ:
```bash
pnpm add react-hot-toast
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `packages/web/src/lib/toast.ts`
- Update: Ù‡Ù…Ù‡ services
- Update: `packages/web/src/app/layout.tsx` (add Toaster component)

---

### 18. âš ï¸ No Image Optimization for Production

**Ø´Ø¯Øª:** ğŸŸ  High (Performance)
**Ù…Ú©Ø§Ù†:** Frontend - Next.js Config
**ØªØ§Ø«ÛŒØ±:** ØªØµØ§ÙˆÛŒØ± Ø¨Ø¯ÙˆÙ† optimization Ø³Ø±Ùˆ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯

#### Ù…Ø´Ú©Ù„:
```typescript
// next.config.ts
const nextConfig: NextConfig = {
  // âŒ Ù‡ÛŒÚ† ØªÙ†Ø¸ÛŒÙ…Ø§ØªÛŒ Ø¨Ø±Ø§ÛŒ images
};
```

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
// packages/web/next.config.ts
import type { NextConfig } from 'next';

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'http',
        hostname: 'localhost',
        port: '5000',
      },
      {
        protocol: 'https',
        hostname: 'mehrebaran.org',
      },
      {
        protocol: 'https',
        hostname: '*.cloudinary.com', // Ø§Ú¯Ø± Ø§Ø² Cloudinary Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
      },
      {
        protocol: 'https',
        hostname: '*.amazonaws.com', // Ø§Ú¯Ø± Ø§Ø² S3 Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
      },
    ],
    formats: ['image/avif', 'image/webp'],
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
    minimumCacheTTL: 60,
  },
};

export default nextConfig;

// Ø§Ø³ØªÙØ§Ø¯Ù‡
import Image from 'next/image';

<Image
  src={need.image}
  alt={need.title}
  width={400}
  height={300}
  quality={85}
  priority={isAboveFold}
/>
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Update: `packages/web/next.config.ts`
- Update: components Ú©Ù‡ `<img>` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ â†’ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ `<Image>`

---

### 19. âš ï¸ MongoDB Indexes Missing on Frequently Queried Fields

**Ø´Ø¯Øª:** ğŸŸ  High (Performance)
**Ù…Ú©Ø§Ù†:** Backend - Models
**ØªØ§Ø«ÛŒØ±:** Queries Ú©Ù†Ø¯ Ù‡Ø³ØªÙ†Ø¯

#### Ù…Ø´Ú©Ù„:
Ø¨Ø±Ø®ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù¾Ø±Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù†Ø¯Ø§Ø±Ù†Ø¯.

#### Ù…Ø«Ø§Ù„:
```typescript
// Need model
needSchema.index({ createdBy: 1 }); // âœ… Ø¯Ø§Ø±Ø¯
needSchema.index({ category: 1 }); // âœ… Ø¯Ø§Ø±Ø¯

// âŒ Ø§ÛŒÙ†â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù†Ø¯Ø§Ø±Ù†Ø¯:
// - status (frequently filtered)
// - location.city (geographic search)
// - urgencyLevel (filtering)
// - totalLikes (sorting by popularity)
```

#### Ø±Ø§Ù‡ Ø­Ù„:
```typescript
// packages/api/src/models/Need.ts
needSchema.index({ status: 1 });
needSchema.index({ urgencyLevel: 1 });
needSchema.index({ totalLikes: -1 }); // Descending for sorting
needSchema.index({ 'location.city': 1 });
needSchema.index({ createdAt: -1 }); // Sorting by newest

// Compound indexes for common queries
needSchema.index({ status: 1, category: 1 });
needSchema.index({ status: 1, createdAt: -1 });
needSchema.index({ createdBy: 1, status: 1 });

// Text index for search
needSchema.index({ title: 'text', description: 'text' });

// User model
userSchema.index({ mobile: 1 }, { unique: true }); // âœ… Ø¯Ø§Ø±Ø¯
userSchema.index({ 'stats.totalPoints': -1 }); // âœ… Ø¨Ø±Ø§ÛŒ leaderboard

// âŒ Ø§ÛŒÙ†â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ù†Ø¯Ø§Ø±Ù†Ø¯:
userSchema.index({ role: 1 });
userSchema.index({ isActive: 1 });
userSchema.index({ createdAt: -1 });
```

#### Ú†Ú© Ú©Ø±Ø¯Ù† indexes ÙØ¹Ù„ÛŒ:
```javascript
// Ø¯Ø± MongoDB shell ÛŒØ§ Compass
db.needs.getIndexes();
db.users.getIndexes();
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Update: `packages/api/src/models/Need.ts`
- Update: `packages/api/src/models/User.ts`
- Update: Ø¯ÛŒÚ¯Ø± models

---

### 20. âš ï¸ No Database Backup Strategy

**Ø´Ø¯Øª:** ğŸŸ  High
**Ù…Ú©Ø§Ù†:** Infrastructure
**ØªØ§Ø«ÛŒØ±:** Ø¯Ø± ØµÙˆØ±Øª data lossØŒ Ù‡ÛŒÚ† backup ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯

#### Ø±Ø§Ù‡ Ø­Ù„:
```bash
#!/bin/bash
# scripts/backup-db.sh

DATE=$(date +%Y-%m-%d_%H-%M-%S)
BACKUP_DIR="/backups/mongodb"
DB_NAME="mehrebaran"

mkdir -p $BACKUP_DIR

# Create backup
mongodump --db=$DB_NAME --out=$BACKUP_DIR/$DATE

# Compress
tar -czf $BACKUP_DIR/$DATE.tar.gz $BACKUP_DIR/$DATE
rm -rf $BACKUP_DIR/$DATE

# Delete backups older than 30 days
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete

echo "âœ… Backup completed: $BACKUP_DIR/$DATE.tar.gz"
```

```bash
# Crontab - Ø±ÙˆØ²Ø§Ù†Ù‡ Ø³Ø§Ø¹Øª 2 Ø¨Ø§Ù…Ø¯Ø§Ø¯
0 2 * * * /path/to/scripts/backup-db.sh
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `scripts/backup-db.sh`
- Create: `scripts/restore-db.sh`

---

## ğŸŸ¡ Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Medium Priority

### 21. âš ï¸ No Docker Configuration

**Ø´Ø¯Øª:** ğŸŸ¡ Medium
**Ù…Ú©Ø§Ù†:** Root
**ØªØ§Ø«ÛŒØ±:** Setup Ù…Ø­ÛŒØ· development Ø³Ø®Øª Ø§Ø³Øª

#### Ø±Ø§Ù‡ Ø­Ù„:
```dockerfile
# Dockerfile.api
FROM node:20-alpine

WORKDIR /app

# Install pnpm
RUN npm install -g pnpm

COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY packages/api/package.json ./packages/api/

RUN pnpm install --frozen-lockfile

COPY packages/api ./packages/api

WORKDIR /app/packages/api

RUN pnpm build

EXPOSE 5000

CMD ["pnpm", "start"]
```

```dockerfile
# Dockerfile.web
FROM node:20-alpine

WORKDIR /app

RUN npm install -g pnpm

COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY packages/web/package.json ./packages/web/

RUN pnpm install --frozen-lockfile

COPY packages/web ./packages/web

WORKDIR /app/packages/web

RUN pnpm build

EXPOSE 3000

CMD ["pnpm", "start"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  mongodb:
    image: mongo:7
    container_name: mehrebaran-mongo
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db
    environment:
      MONGO_INITDB_DATABASE: mehrebaran

  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    container_name: mehrebaran-api
    ports:
      - "5000:5000"
    environment:
      DATABASE_URL: mongodb://mongodb:27017/mehrebaran
      NODE_ENV: development
    depends_on:
      - mongodb
    volumes:
      - ./packages/api:/app/packages/api
      - /app/packages/api/node_modules

  web:
    build:
      context: .
      dockerfile: Dockerfile.web
    container_name: mehrebaran-web
    ports:
      - "3000:3000"
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:5000/api/v1
    depends_on:
      - api
    volumes:
      - ./packages/web:/app/packages/web
      - /app/packages/web/node_modules

volumes:
  mongodb_data:
```

#### ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ·Ù‡:
- Create: `Dockerfile.api`
- Create: `Dockerfile.web`
- Create: `docker-compose.yml`
- Create: `.dockerignore`

---

### 22-35. Ø³Ø§ÛŒØ± Ù…Ø´Ú©Ù„Ø§Øª Medium Priority

Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø´Ø¯Ù†ØŒ Ø®Ù„Ø§ØµÙ‡â€ŒØ§ÛŒ Ø§Ø² Ø¨Ù‚ÛŒÙ‡:

| # | Ù…Ø´Ú©Ù„ | Ø§ÙˆÙ„ÙˆÛŒØª | Ø±Ø§Ù‡ Ø­Ù„ |
|---|------|--------|--------|
| 22 | No CI/CD Pipeline | ğŸŸ¡ | GitHub Actions workflow |
| 23 | Missing API Documentation | ğŸŸ¡ | Swagger/OpenAPI |
| 24 | No Health Check Endpoint | ğŸŸ¡ | `GET /health` |
| 25 | Email Service Not Implemented | ğŸŸ¡ | SendGrid/Mailgun integration |
| 26 | SMS Service Not Implemented | ğŸŸ¡ | Twilio integration |
| 27 | Push Notifications Not Implemented | ğŸŸ¡ | Firebase FCM |
| 28 | No Redis Caching | ğŸŸ¡ | Redis setup |
| 29 | No CDN for Static Files | ğŸŸ¡ | CloudFront/Cloudflare |
| 30 | Cloud Storage Not Configured | ğŸŸ¡ | AWS S3/Cloudinary |
| 31 | No Monitoring/Alerting | ğŸŸ¡ | Prometheus/Grafana |
| 32 | No Unit Tests | ğŸŸ¡ | Jest + Supertest |
| 33 | No Integration Tests | ğŸŸ¡ | Testing library |
| 34 | No E2E Tests | ğŸŸ¡ | Playwright/Cypress |
| 35 | Frontend: No Suspense Boundaries | ğŸŸ¡ | React Suspense |

---

## ğŸ” Ù…Ø´Ú©Ù„Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ (Ø®Ù„Ø§ØµÙ‡)

| # | Ù…Ø´Ú©Ù„ | Ø´Ø¯Øª | ÙØ§ÛŒÙ„ |
|---|------|-----|------|
| 1 | CORS wildcard (*) | ğŸ”´ Critical | `packages/api/src/app.ts` |
| 2 | No rate limiting | ğŸ”´ Critical | - |
| 3 | No input sanitization | ğŸ”´ Critical | Controllers |
| 4 | OTP brute force possible | ğŸŸ  High | `auth.controller.ts` |
| 5 | No password complexity validation | ğŸŸ¡ Medium | `User.ts` |
| 6 | JWT secret too short/weak | ğŸŸ¡ Medium | `.env` |
| 7 | No HTTPS enforcement | ğŸŸ¡ Medium | Production config |
| 8 | Sensitive data in logs | ğŸŸ¡ Medium | Error handlers |

---

## ğŸš€ Ù…Ø´Ú©Ù„Ø§Øª Performance (Ø®Ù„Ø§ØµÙ‡)

| # | Ù…Ø´Ú©Ù„ | ØªØ§Ø«ÛŒØ± | Ø±Ø§Ù‡ Ø­Ù„ |
|---|------|-------|--------|
| 1 | No pagination limits | High | Max 100 items |
| 2 | Missing database indexes | High | Add indexes |
| 3 | No query caching | Medium | Redis |
| 4 | No image optimization | Medium | Next/Image + CDN |
| 5 | No gzip compression | Low | Express compression |

---

## ğŸ§ª Ú¯Ù¾â€ŒÙ‡Ø§ÛŒ Testing

| Ù†ÙˆØ¹ ØªØ³Øª | ÙˆØ¶Ø¹ÛŒØª | Coverage |
|---------|--------|----------|
| Unit Tests | âŒ Ù‡ÛŒÚ† | 0% |
| Integration Tests | âŒ Ù‡ÛŒÚ† | 0% |
| E2E Tests | âŒ Ù‡ÛŒÚ† | 0% |
| Load Tests | âŒ Ù‡ÛŒÚ† | 0% |

---

## ğŸ“Š Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ùˆ Roadmap

### ğŸ”¥ ÙÙˆØ±ÛŒ (Ø§ÛŒÙ† Ù‡ÙØªÙ‡)

1. âœ… Ø±ÙØ¹ CORS wildcard
2. âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† rate limiting
3. âœ… Ø±ÙØ¹ API endpoint mismatches
4. âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† input sanitization
5. âœ… Ø§ÛŒØ¬Ø§Ø¯ .env.example files

### ğŸ“… Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯Øª (Ø§ÛŒÙ† Ù…Ø§Ù‡)

1. âœ… Environment validation
2. âœ… Error logging system
3. âœ… Database connection error handling
4. âœ… Frontend error boundaries
5. âœ… Password reset flow
6. âœ… OTP attempt limiting
7. âœ… Pagination validation
8. âœ… Add missing indexes

### ğŸ“† Ù…ÛŒØ§Ù†â€ŒÙ…Ø¯Øª (1-3 Ù…Ø§Ù‡)

1. âœ… Docker configuration
2. âœ… CI/CD pipeline
3. âœ… Email service integration
4. âœ… SMS service integration
5. âœ… Push notifications
6. âœ… Redis caching
7. âœ… Cloud storage (S3/Cloudinary)
8. âœ… Socket.IO completion
9. âœ… Unit tests (>70% coverage)
10. âœ… Integration tests

### ğŸ“… Ø¨Ù„Ù†Ø¯â€ŒÙ…Ø¯Øª (3-6 Ù…Ø§Ù‡)

1. âœ… E2E tests
2. âœ… Monitoring & alerting
3. âœ… CDN setup
4. âœ… Load testing
5. âœ… API documentation (Swagger)
6. âœ… Database backup automation
7. âœ… Security audit
8. âœ… Performance optimization

---

## ğŸ¯ ØªÙˆØµÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ

### Ø¨Ø±Ø§ÛŒ Production:

#### Must-Have (Ù‚Ø¨Ù„ Ø§Ø² launch):
- [x] Ø±ÙØ¹ Ù‡Ù…Ù‡ Ø¨Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Critical
- [x] Setup monitoring
- [x] Database backups
- [x] HTTPS
- [x] Security headers
- [x] Rate limiting
- [x] Error logging

#### Nice-to-Have:
- [ ] Unit tests
- [ ] Redis caching
- [ ] CDN
- [ ] CI/CD

### Ø¨Ø±Ø§ÛŒ Developer Experience:

- [x] Docker setup
- [x] .env.example files
- [x] API documentation
- [ ] Contributing guide
- [ ] Development guidelines

---

## ğŸ“ Ø®Ù„Ø§ØµÙ‡

- **Total Issues:** 45+
- **Critical:** 8
- **High:** 12
- **Medium:** 15
- **Low:** 10

**Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…:** Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ù‡ Ø·ÙˆØ± Ú©Ù„ÛŒ Ø®ÙˆØ¨ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ù…Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø±ÙØ¹ Ù…Ø´Ú©Ù„Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ Ùˆ ØªÚ©Ù…ÛŒÙ„ external services Ø¯Ø§Ø±Ø¯ Ù‚Ø¨Ù„ Ø§Ø² production.

---

**ØªØ§Ø±ÛŒØ®:** Û²Û² Ø¨Ù‡Ù…Ù† Û±Û´Û°Û³
**ØªÙ‡ÛŒÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø·:** Claude Code AI Agent
